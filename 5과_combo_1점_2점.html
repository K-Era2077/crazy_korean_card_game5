<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œìš¸ëŒ€ í•œêµ­ì–´ 4A - 5ê³¼ ë‹¨ì–´ ê²Œì„</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #f5f7fb;
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        .game-container {
            background: #ffffff;
            width: 100%;
            max-width: 600px;
            padding: 20px;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        h1 { font-size: 1.2rem; text-align: center; margin-bottom: 5px; }
        .subtitle { text-align: center; font-size: 0.85rem; color: #666; margin-bottom: 15px; }
        
        .top-row { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        .chip-label { font-weight: bold; font-size: 14px; margin-right: 5px; }

        .status-bar { display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; }
        
        .card { 
            background: #f0f4ff; border-radius: 14px; padding: 30px 15px; 
            margin-bottom: 15px; text-align: center; 
        }
        .question-text { font-size: 2.2rem; font-weight: bold; color: #333; margin-bottom: 10px; word-break: keep-all; }
        .lang-label { font-size: 0.9rem; color: #6b7280; }

        #options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .option-btn {
            padding: 20px 10px; font-size: 1.2rem; border-radius: 10px;
            border: 2px solid #e5e7eb; background: #f9fafb; cursor: pointer;
            transition: all 0.2s; word-break: keep-all; min-height: 80px;
            display: flex; align-items: center; justify-content: center;
        }
        .option-btn.correct { background: #dcfce7 !important; border-color: #22c55e !important; color: #166534; }
        .option-btn.wrong { background: #fee2e2 !important; border-color: #ef4444 !important; color: #991b1b; }

        #next-btn {
            margin-top: 20px; width: 100%; padding: 15px; font-size: 1.5rem;
            background: #4f46e5; color: white; border: none; border-radius: 12px;
            cursor: pointer; font-weight: bold;
        }
        #next-btn:disabled { background: #ccc; cursor: not-allowed; }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 100; }
        .overlay.show { display: flex; }
        .celebrate-card { background: white; padding: 30px; border-radius: 20px; text-align: center; max-width: 80%; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        
        /* í­ì£½ ì• ë‹ˆë©”ì´ì…˜ */
        .confetti { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; }
        .confetti span {
            position: absolute; width: 10px; height: 10px; background: #ff0;
            animation: fall 3s linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(-100vh) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(720deg); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ì„œìš¸ëŒ€ í•œêµ­ì–´ 4A - 5ê³¼ ë‹¨ì–´ í€´ì¦ˆ</h1>
        <div class="subtitle">5ê³¼ ì–´íœ˜ë¥¼ ë§ˆìŠ¤í„°í•´ ë³´ì„¸ìš”!</div>

        <div class="top-row">
            <div class="direction">
                <span class="chip-label">ë°©í–¥:</span>
                <label><input type="radio" name="direction" value="vi2ko" checked> ğŸ‡»ğŸ‡³ â†’ ğŸ‡°ğŸ‡·</label>
                <label><input type="radio" name="direction" value="ko2vi"> ğŸ‡°ğŸ‡· â†’ ğŸ‡»ğŸ‡³</label>
            </div>
        </div>

        <div class="status-bar">
            <span>ë¬¸ì œ: <span id="q-num">1</span></span>
            <span class="word-count">ë‹¨ì–´ ìˆ˜: <span id="wordCount"></span></span>
            <span>ì ìˆ˜: <span id="current-score">0</span></span>
        </div>

        <div class="card">
            <div class="lang-label" id="lang-label">í•™ìŠµ ì¤€ë¹„ ì™„ë£Œ!</div>
            <div class="question-text" id="q-text">ì‹œì‘í•˜ë ¤ë©´ í´ë¦­</div>
        </div>

        <div id="options"></div>
        <div id="message" style="text-align:center; margin-top:10px; min-height:1.5em; font-weight:bold;"></div>
        <button id="next-btn" disabled>ë‹¤ìŒ ë¬¸ì œ</button>
    </div>

    <div class="overlay" id="overlay">
        <div class="confetti" id="confetti-container"></div>
        <div class="celebrate-card">
            <h2 style="font-size: 2rem;">ğŸŠ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸŠ</h2>
            <p style="font-size: 1.2rem;">5ê³¼ ë‹¨ì–´ í€´ì¦ˆ 100ì ì„ ë‹¬ì„±í•˜ì…¨ìŠµë‹ˆë‹¤!</p>
            <p>ë‹¹ì‹ ì€ ì´ì œ 5ê³¼ ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤.</p>
            <button onclick="location.reload()" style="padding:10px 20px; background:#4f46e5; color:white; border:none; border-radius:10px; cursor:pointer;">ë‹¤ì‹œ í•˜ê¸°</button>
        </div>
    </div>

    
    <script>
        // 5ê³¼ ë°ì´í„° (ì˜¬ì¸ì›)
        const WORDS_ALL = [
            ["ì…ì´ ê°€ë³ë‹¤", "láº»o mÃ©p, hay buÃ´n chuyá»‡n"], ["ì…ì´ ë¬´ê²ë‹¤", "kÃ­n tiáº¿ng"], ["ì…ì´ ì§§ë‹¤", "kÃ©n Äƒn"],
            ["ëˆˆì´ ë†’ë‹¤", "tiÃªu chuáº©n cao"], ["ê·€ê°€ ì–‡ë‹¤", "dá»… tin ngÆ°á»i"], ["ë°œì´ ë„“ë‹¤", "quan há»‡ rá»™ng"],
            ["ì¸ì •ì„ ë°›ë‹¤", "Ä‘Æ°á»£c ê³µ nháº­n"], ["ì•¼ë‹¨ì„ ì¹˜ë‹¤", "máº¯ng"], ["ì‹ ì… ì‚¬ì›", "nhÃ¢n viÃªn má»›i"],
            ["ë¶€ì¥ë‹˜", "trÆ°á»Ÿng phÃ²ng"], ["í˜¼ë‚˜ë‹¤", "bá»‹ máº¯ng"], ["ë§ˆíŠ¸", "cá»­a hÃ ng / siÃªu thá»‹"],
            ["ê²½ìŸ", "sá»± cáº¡nh tranh"], ["ì¥ì‚¬ê°€ ì•ˆë˜ë‹¤", "buÃ´n bÃ¡n khÃ´ng thuáº­n lá»£i"], ["ëˆˆë©ì´", "cá»¥c tuyáº¿t"],
            ["ì™¸ë¡œì›€", "sá»± cÃ´ Ä‘Æ¡n"], ["ìƒì‹", "kiáº¿n thá»©c thÃ´ng thÃ´ng thÆ°á»ng"], ["í’ë¶€í•˜ë‹¤", "phong phÃº"],
            ["ì‚¬ì—°", "cÃ¢u chuyá»‡n, hoÃ n cáº£nh"], ["ì—¬ëŒ€ìƒ", "sinh viÃªn ná»¯"], ["ì—°ë½ì´ ëœ¸í•˜ë‹¤", "Ã­t liÃªn láº¡c"],
            ["ê¸°ë§ê³ ì‚¬", "thi cuá»‘i kÃ¬"], ["ì™ ì§€", "khÃ´ng hiá»ƒu sao"], ["ë°°ì‹ ê°", "cáº£m giÃ¡c bá»‹ pháº£n bá»™i"],
            ["ì•ˆíƒ€ê¹ë‹¤", "tiáº¿c nuá»‘i"], ["ì„ì‚¬", "tháº¡c sÄ©"], ["ë…¼ë¬¸", "luáº­n vÄƒn"], ["ëŠê¸‹í•˜ê²Œ", "má»™t cÃ¡ch cháº­m rÃ£i"],
            ["ë°•ì‚¬ê³¼ì •", "quÃ¡ trÃ¬nh há»c tiáº¿n sÄ©"], ["ì…í•™ ì›ì„œ", "Ä‘Æ¡n xin nháº­p há»c"], ["ë§ˆê°", "háº¡n"],
            ["ê²¹ì¹˜ë‹¤", "chá»“ng lÃªn"], ["ì •ì‹ ì´ ì—†ë‹¤", "khÃ´ng cÃ³ tÃ¢m trÃ­"], ["í•˜í•„ì´ë©´", "sao cá»© pháº£i lÃ "],
            ["ê²¨ìš°", "má»™t cÃ¡ch khÃ³ khÄƒn"], ["ì›”ì„¸", "tiá»n thuÃª nhÃ  hÃ ng thÃ¡ng"]
        ];
        document.getElementById("wordCount").textContent = WORDS_ALL.length;

        // ===== ì„¤ì • =====
        const BASE_POINTS = 1;        // ê¸°ë³¸ ì •ë‹µ ì ìˆ˜
        const COMBO_BONUS = 1;        // ì½¤ë³´(ì—°ì† ì •ë‹µ) ë³´ë„ˆìŠ¤
        // ì½¤ë³´ ì ìˆ˜ = BASE_POINTS + COMBO_BONUS  (ì¦‰, 3ì )

        let score = 0;
        let questionCount = 1;
        let direction = "vi2ko";

        // ë±(ì¤‘ë³µ ì—†ì´ í•œ ë°”í€´ ëŒê¸°)
        let deck = [];
        let lastQuestionKey = null;   // ì§ì „ ë¬¸ì œ(ì¤‘ë³µ ë°©ì§€)
        let streak = 0;               // ì—°ì† ì •ë‹µ(ì½¤ë³´) ì¹´ìš´íŠ¸

        const qText = document.getElementById("q-text");
        const langLabel = document.getElementById("lang-label");
        const optionsDiv = document.getElementById("options");
        const nextBtn = document.getElementById("next-btn");
        const scoreEl = document.getElementById("current-score");
        const qNumEl = document.getElementById("q-num");
        const messageEl = document.getElementById("message");

        // ì¶•í•˜ íš¨ê³¼ìŒ (ê¸°ì¡´ Base64 ë‚´ì¥ ìŒì› ìœ ì§€)
        const cheerAudio = new Audio("data:audio/mpeg;base64,//uUBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAETAAGeAAACBQgLDQ8SFRcaHB8hJCcpKy4xNDU4Oz5AQ0VISk1QUlRXWl1eYWRnaWtucXN2eXt9gIOGh4qNkJKUl5qcn6Gkpqmsr7Cztrm7vcDDxcjKzc/S1dfZ3N/i5Obp7O7x8/b4+/4AAAA7TEFNRTMuMTAwAaoAAAAAAAAAABSAJAJAhgAAgAABngA4AvjL...");

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createConfetti() {
            const container = document.getElementById("confetti-container");
            container.innerHTML = "";
            for (let i = 0; i < 60; i++) {
                const span = document.createElement("span");
                span.style.left = Math.random() * 100 + "vw";
                span.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 55%)`;
                span.style.animationDelay = Math.random() * 1.6 + "s";
                container.appendChild(span);
            }
        }

        function showCelebration() {
            document.getElementById("overlay").classList.add("show");
            createConfetti();
            try {
                cheerAudio.currentTime = 0;
                cheerAudio.play().catch(() => {});
            } catch (e) {}
        }

        function rebuildDeck() {
            // ë±ì„ ì¸ë±ìŠ¤ë¡œ êµ¬ì„±í•´ì„œ ì¤‘ë³µ ì—†ì´ ì¶œì œ
            deck = Array.from({ length: WORDS_ALL.length }, (_, i) => i);
            shuffle(deck);

            // ìƒˆ ë±ì˜ ë§ˆì§€ë§‰(=popë  ì²« ë¬¸ì œ)ì´ ì§ì „ ë¬¸ì œì™€ ê°™ìœ¼ë©´ swap
            if (deck.length >= 2) {
                const firstIdx = deck[deck.length - 1];
                const firstKey = WORDS_ALL[firstIdx][0]; // í•œêµ­ì–´ë¥¼ ë¬¸ì œ í‚¤ë¡œ ê³ ì •
                if (lastQuestionKey && firstKey === lastQuestionKey) {
                    const a = deck.length - 1;
                    const b = deck.length - 2;
                    [deck[a], deck[b]] = [deck[b], deck[a]];
                }
            }
        }

        function pickNextWord() {
            if (deck.length === 0) rebuildDeck();

            let idx = deck.pop();
            let key = WORDS_ALL[idx][0];

            if (lastQuestionKey && key === lastQuestionKey && deck.length > 0) {
                const idx2 = deck.pop();
                deck.push(idx);
                idx = idx2;
                key = WORDS_ALL[idx][0];
            }

            lastQuestionKey = key;
            return WORDS_ALL[idx];
        }

        function newQuestion() {
            if (score >= 100) {
                showCelebration();
                return;
            }

            nextBtn.disabled = true;
            messageEl.textContent = "";

            const correctWord = pickNextWord(); // [ko, vi]
            const q = direction === "vi2ko" ? correctWord[1] : correctWord[0];
            const ans = direction === "vi2ko" ? correctWord[0] : correctWord[1];

            langLabel.textContent = direction === "vi2ko" ? "Tiáº¿ng Viá»‡t" : "í•œêµ­ì–´";
            qText.textContent = q;

            const pool = WORDS_ALL.map(w => direction === "vi2ko" ? w[0] : w[1])
                                  .filter(v => v && v !== ans);

            shuffle(pool);
            let choices = [ans, pool[0], pool[1], pool[2]];
            shuffle(choices);

            optionsDiv.innerHTML = "";
            choices.forEach(choice => {
                const btn = document.createElement("button");
                btn.className = "option-btn";
                btn.textContent = choice;
                btn.onclick = () => checkAnswer(choice, ans, btn);
                optionsDiv.appendChild(btn);
            });
        }

        function checkAnswer(selected, correct, btn) {
            const allBtns = document.querySelectorAll(".option-btn");
            allBtns.forEach(b => b.disabled = true);

            if (selected === correct) {
                btn.classList.add("correct");

                const gained = (streak >= 1) ? (BASE_POINTS + COMBO_BONUS) : BASE_POINTS;
                score += gained;
                streak += 1;

                scoreEl.textContent = score;
                messageEl.textContent = (gained === BASE_POINTS)
                    ? `ì •ë‹µì…ë‹ˆë‹¤! +${gained}ì  ğŸ‰`
                    : `ì½¤ë³´! +${gained}ì  ğŸ”¥`;
                messageEl.style.color = "#166534";
            } else {
                btn.classList.add("wrong");
                streak = 0;
                messageEl.textContent = `í‹€ë ¸ì–´ìš”. ì •ë‹µì€: ${correct}`;
                messageEl.style.color = "#dc2626";
            }

            if (score >= 100) {
                showCelebration();
                return;
            }

            nextBtn.disabled = false;
        }

        nextBtn.onclick = () => {
            questionCount++;
            qNumEl.textContent = questionCount;
            newQuestion();
        };

        document.querySelectorAll('input[name="direction"]').forEach(r => {
            r.onchange = (e) => {
                direction = e.target.value;
                score = 0;
                questionCount = 1;
                streak = 0;
                lastQuestionKey = null;
                scoreEl.textContent = "0";
                qNumEl.textContent = "1";
                rebuildDeck();
                newQuestion();
            };
        });

        rebuildDeck();
        newQuestion();
    </script>

</body>
</html>